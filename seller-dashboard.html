<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard - Hostel Hustle</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 1000;
      left: 50%;
      bottom: 30px;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.5s ease, bottom 0.5s ease;
    }
    .toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <img src="images/logo.png" alt="Hostel Hustle Logo">
    </div>
    <div class="nav-actions">
      <span id="welcome-user"></span>
      <button><a href="index.html">🏠 Home</a></button>
      <button><a href="cart.html">🛒 Cart</a></button>
      <button><a href="orders.html">🧾 My Orders</a></button>
      <!--LOGIN button (only shown if not signed in)-->
      <a href="login.html" id="login-link" style="display: none;">🔐 Login</a>
      <!--LOGOUT button (only shown if signed in)-->
      <button id="logout-btn"><a href="login.html">🚪 Logout</a></button>
      <button><a href="admin.html" id="admin-dashboard-link" style="display: none;"> Admin</a></button>
      <button><a href="admin-products.html" id="admin-products-link" style="display: none;"> Admin Products</a></button>
      <label class="switch">
        <input type="checkbox" id="dark-toggle">
        <span class="slider"></span>
      </label>
      <small style="font-size: 12px;">dark-mode</small>
    </div>
  </header>
  <main class="main-content">
    <h1>📦 Seller Dashboard</h1>

    <form id="upload-form" class="checkout-form" >
      <input type="hidden" id="product-id" />
      <label for="name">Product Name</label>
      <input type="text" id="product-name" required>

      <label for="price">Price</label>
      <input type="number" id="product-price" required>

      <label for="category">Category</label>
      <select id="product-category" required>
        <option value="toiletries">🧼 Toiletries</option>
        <option value="wears">👕 Wears</option>
        <option value="cooking materials">🍲 Cooking Materials</option>
        <option value="hair accessories">💇 Hair Accessories</option>
        <option value="food stuffs">🍚 Food Stuffs</option>
      </select>

      <label for="image">Image URL</label>
      <input type="file" id="product-image" accept="image/*" onchange="previewImage()" required>
      <img id="image-preview" src="#" alt="Image Preview" style="max-width: 150px; display: none;" />
      <button type="submit">Upload Product</button>
    </form>

    <section>
    <h2>Your Uploaded Products</h2>
    <div id="seller-products" class="product-grid"></div>
    </section>
  </main>
 
  <div id="toast" class="toast">Product saved successfully!</div>  
  <script src="auth.js"></script>
 <script>
    const currentUser = localStorage.getItem("currentUser");
    const welcomeUser = document.getElementById("welcome-user");
    const logoutBtn = document.getElementById("logout-btn");
    const loginLink = document.getElementById("login-link");

    if (!currentUser) {
      loginLink.style.display = "inline-block";
    } else {
      welcomeUser.textContent = `Welcome, ${currentUser}`;
      logoutBtn.style.display = "inline-block";
    }

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    });

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function previewImage() {
      const file = document.getElementById("product-image").files[0];
      const preview = document.getElementById("image-preview");
      const reader = new FileReader();
      reader.onloadend = function () {
        preview.src = reader.result;
        preview.style.display = "block";
      };
      if (file) {
        reader.readAsDataURL(file);
      } else {
        preview.style.display = "none";
      }
    }

    function loadSellerProducts() {
      const all = JSON.parse(localStorage.getItem("products")) || [];
      const mine = all.filter(p => p.seller === currentUser);
      const container = document.getElementById("seller-products");
      container.innerHTML = "";
      if (mine.length === 0) {
        container.innerHTML = "<p>No products uploaded yet.</p>";
        return;
      }
      mine.forEach(p => {
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>₦${p.price}</p>
          <p>Category: ${p.category}</p>
          <button onclick="editProduct(${p.id})">✏️ Edit</button>
          <button onclick="deleteProduct(${p.id})">🗑️ Delete</button>
        `;
        container.appendChild(div);
      });
    }

    function editProduct(id) {
      const products = JSON.parse(localStorage.getItem("products")) || [];
      const p = products.find(p => p.id === id);
      if (p) {
        document.getElementById("product-id").value = p.id;
        document.getElementById("product-name").value = p.name;
        document.getElementById("product-price").value = p.price;
        document.getElementById("product-category").value = p.category;
        document.getElementById("image-preview").src = p.image;
        document.getElementById("image-preview").style.display = "block";
      }
    }

    function deleteProduct(id) {
      if (!confirm("Delete this product?")) return;
      let products = JSON.parse(localStorage.getItem("products")) || [];
      products = products.filter(p => p.id !== id);
      localStorage.setItem("products", JSON.stringify(products));
      showToast("Deleted");
      loadSellerProducts();
    }

    document.getElementById("upload-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const id = document.getElementById("product-id").value || Date.now();
      const name = document.getElementById("product-name").value;
      const price = parseFloat(document.getElementById("product-price").value);
      const category = document.getElementById("product-category").value;
      const imageFile = document.getElementById("product-image").files[0];

      const reader = new FileReader();
      reader.onload = function () {
        const image = reader.result;
        let products = JSON.parse(localStorage.getItem("products")) || [];

        const product = {
          id: Number(id),
          name,
          price,
          category,
          image,
          seller: currentUser
        };

        const index = products.findIndex(p => p.id === Number(id));
        if (index !== -1) {
          products[index] = product;
        } else {
          products.push(product);
        }

        localStorage.setItem("products", JSON.stringify(products));
        document.getElementById("upload-form").reset();
        document.getElementById("image-preview").style.display = "none";
        showToast("Product saved");
        loadSellerProducts();
      };

      if (imageFile) {
        reader.readAsDataURL(imageFile);
      }
    });

    loadSellerProducts();
  </script>
</body>
</html>
